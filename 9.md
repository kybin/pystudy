# 2019-03-20

제가 돌아왔습니다~

지금까지 저희가 팀을 구성하고, 클랜에 가입하고, 아이템을 까는 것 등을 프로그래밍 해보았지만
사실 이 게임의 가장 중요한 부분은 맵 안에 들어가 움직이고 서로 싸우는 거죠.

오늘은 이 중 맵을 한번 만들어 볼까 합니다. 저희가 만드는 맵은 진짜 게임처럼
실감나진 않겠지만 개념을 이해하기에는 부족하지 않습니다.

오늘 그릴 맵은 #으로 둘러싼 정사각형입니다.

```
####
#  #
#  #
####
```

또한 오늘부터는 curses라는 모듈을 사용할 생각입니다. curses는 터미널에서 키보드나 마우스 입력을 받고
화면을 내가 원하는 대로 변경하기 위한 모듈입니다.
그런데 이 curses가 윈도우즈에서는 돌아가지 않네요. (방법을 아시는 분은 제게 연락주세요.)
그래서 윈도우즈 사용자분들을 위해 제 (피 같은) 서버를 제공할 생각입니다.

그게 무슨 말이냐고요? git-bash를 열고 아래 명령을 실행하세요.

```
ssh guest@lazyd.org
# 비밀번호는 따로 알려드립니다.
```

비밀번호를 입력하셨다면 제가 운영하는 lazyd.org라는 사이트에 guest 계정으로 들어오실 수 있습니다.
다만 이제부터는 완벽한 터미널 환경이라 조금 불편하실수도 있습니다.

터미널을 사용할 때 가장 불편한 것은 저희가 한창 익숙해지고 있던 서브라임 텍스트 에디터를 쓰지
못한다는 겁니다. 이럴수가... 하지만 위기가 곧 기회이듯, 지금이 vim을 배우기에 적기인 것 같군요!
모든 프로그래머들이 모두 언젠가는 한번씩 다룰수 밖에 없는 바로 그 에디터, vim입니다.

vim은 불편한 에디터입니다. 저희처럼 서브라임같은 에디터를 사용하다가 vim을 사용하면 그 불편함에
깜짝 놀랄수 밖에 없죠. 하지만 그럴수 밖에 없는 이유가 있습니다. vim이 터미널용 에디터이기 때문입니다.

터미널은 많은 한계를 가지고 있습니다. 마우스 입력도 제한적이고, 키보드도 어떤 조합은 먹지 않습니다.
예를 들어 터미널에은 Ctrl+J 키와 엔터를 구분하지 못합니다.

사실 터미널은 원래 서버에 연결해서 명령을 전송하고 결과를 받아오는 하드웨어였습니다.
아래는 초창기 하드웨어 터미널 사진입니다.

https://en.wikipedia.org/wiki/VT100#/media/File:DEC_VT100_terminal.jpg


이렇게 터미널이 너무 일찍부터 사용되었기 때문에 네트워크의 속도가 지금처럼 빠르지 않았고
그래서 몇가지 영리한 방법들을 이용해 정보를 최대한 압축해서 전송했습니다.
그런데 이렇게 압축하다보니 데이터 손실을 일으켜 버린거죠.

현재의 터미널도 그 한계에서 아직 벗어나지 못하고 있습니다.

그래도 지금부터는 터미널을 사용해야 합니다.

제 서버에 들어오신 분들은 우선 각자 자기 디렉토리를 하나씩 만들어 주세요.
내 코드와 다른 사람의 코드가 헷갈릴수 있기 때문입니다.


### 주의

앞으로 터미널에서 쓰는 명령은 파이썬 코드와 구분하기 위해 `$` 로 시작하겠습니다.
`$`를 직접 치시는게 아닙니다!

```
$ mkdir 내디렉토리 # 여러분 이름을 쓰세요.
$ cd 내디렉토리
```

이제 vim을 이용해서 파일을 생성해 보겠습니다.

```
$ vim test.py
```

vim의 기본 모드는 노멀 모드입니다. 노멀 모드는 타이핑을 하는 모드가 아닙니다.
파일을 저장하거나 나가거나, 찾는 등의 명령을 수행하는 모드죠.
저희는 `i`를 눌러 최대한 빨리 입력 모드로 들어가겠습니다. 아래의 -- INSERT -- 글자가 보이시나요?
지금부터 글을 쓰면 됩니다.

```
print("hi")
```

일단은 이렇게 쓰고 노멀 모드로 돌아가기 위해 `ESC`키를 누르세요.

노멀 모드로 돌아오면 `:wq` 를 눌러 파일을 저장하고 종료합니다.
`:`은 명령을 실행하겠다는 뜻이고, `w`는 저장, `q`는 종료를 의미합니다.

만일 작성한 내용을 버리고 종료하고 싶다면 `:q!`를 입력합니다.

```
$ python3 test.py
hi
```

실행이 잘 되었나요?

노멀 모드에는 명령을 입력하는 것 외에 다음 행동들을 할 수 있습니다.

```
     j: 한 줄 아래로 이동
     k: 한 줄 위로 이동
     h: 한 칸 앞으로 이동
     l: 한 칸 뒤로 이동
     x: 커서 아래 글자 지움
    yy: 한 줄 복사
     p: 복사된 문자열 붙여넣기
    dd: 한 줄 삭제
     u: 되돌리기
Ctrl+r: 되돌리기 취소
```

그 외에도 많지만 일단 이것만 외워두세요.

만일 이런것들이 너무 어렵다면 vim을 실행시킨 다음에 바로 `i`를 눌러 insert 모드로 들어가고
원하는 코드를 작성한 다음 `ESC`를 눌러 normal 모드로 돌아온 후 `:wq`를 눌러 종료하시면 됩니다.

휴, 이제야 본론으로 들어갈 수 있겠네요.

curses로 화면에 무언가 그리려면 우선 curses.wrapper를 이용해 main 함수를 감싸줘야 합니다.

```
import curses

def main(screen):
	pass

curses.wrapper(main)
```

이렇게 하면 wrapper가 main 함수가 실행되기 전의 준비와 끝난 후의 정리를 대신 해주게 됩니다.
코드 자체는 여러분이 이해하기 조금 어려울 수 있습니다.
겁먹지 마시고 '이렇게 쓰면 그런 일들을 도와주는구나'라고 생각하시면 됩니다.

이제 main 함수에만 집중해 보겠습니다. 자세히 보면 main 함수가 screen 을 받아들이는 것을 알 수 있습니다.
이 screen이 저희가 조작할 화면입니다.

우선 무언가 스크린에 그리기 전에 깨끗이 비워(clear)놓는것이 중요합니다.
그리고 스크린에 원하는 문자열을 그립니다. 저희가 지금 해야 할 일이죠.
가끔씩 스크린에 그린 문자열이 제대로 출력되지 않는 경우가 있습니다.
이 때를 대비해 스크린을 다시 그려(refresh) 줍니다.
그리고 마지막으로는 프로그램이 바로 종료되는 것을 막기 위해 키를 하나 입력(getkey) 받습니다.
여기서는 이 키를 어딘가 쓰려고 입력받는 것은 아닙니다.

```
def main(screen):
	screen.clear()

	# 무언가 스크린에 그린다.

	screen.refresh()
	screen.getkey()
```

저희는 main함수와 실제 저희가 스크린에 그림을 그리는 함수를 분리시키겠습니다.

```
def main(screen):
	screen.clear()

	drawMap(screen)

	screen.refresh()
	screen.getkey()

# drawMap은 screen에 # 으로 둘러쌓인 정사각형 맵을 그린다.
def drawMap(screen):
	pass
```

이 drawMap 함수의 예상 결과물은 맨 처음에 보여드렸던 것과 같습니다.
맵이라고 치기엔 조금 작지만 나중에 키우겠습니다.

```
####
#  #
#  #
####
```

우선은 손으로 # 하나씩 입력을 해보겠습니다. `screen.addstr`을 이용해서요.

`screen.addstr(x, y, string)`은 x줄 y칸에 string을 그려줍니다. string이 한 글자가 아니라면
그 뒤로 죽 이어서 그려지죠.


```
def drawMap(screen):
	# 첫번째 줄
	screen.addstr(0, 0, "#")
	screen.addstr(0, 1, "#")
	screen.addstr(0, 2, "#")
	screen.addstr(0, 3, "#")
	# 두번째 줄
	screen.addstr(1, 0, "#")
	screen.addstr(1, 3, "#")
	# 세번째 줄
	screen.addstr(2, 0, "#")
	screen.addstr(2, 3, "#")
	# 네번째 줄
	screen.addstr(3, 0, "#")
	screen.addstr(3, 1, "#")
	screen.addstr(3, 2, "#")
	screen.addstr(3, 3, "#")
```

test.py를 실행시켜 저희가 원하는 대로 출력되었는지 확인해보세요.
어떤 키든 한번 눌러야 종료된다는 것 잊지 마시고요.

이제 for문을 통해 위의 코드를 좀 더 간략하게 만들어 볼 시간입니다.
우선 법칙을 발견해야 합니다. 위에서 혹시 발견한 패턴이 있으신가요?

...

조금만 더 찾아보세요. 네?

...

찾으신거 맞죠?

...

네, x, y값 중 적어도 하나는 0 이거나 3 이네요.

이를 이용해서 for문을 작성해 보겠습니다.

```
def drawMap(screen):
	for x in range(4):
		for y in range(4):
			if x == 0 or x == 3 or y == 0 or y == 3:
				screen.addstr(x, y, "#")
```

다시 한번 test.py를 실행해보세요. 다들 아까와 동일한 결과를 얻으셨나요?

좋습니다!

오늘은 너무 많은 이야기를 다루어 여기서 마무리 하겠습니다.

숙제가 빠지면 여러분들이 너무 섭섭하겠죠! drawMap이 맵의 크기를 받아서 그 크기만큼
사각형 맵을 그리도록 바꾸어 보세요. 화이팅!

```
def drawMap(screen, size):
```
